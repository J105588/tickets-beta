<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›£æŸ»ãƒ­ã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - å…¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå¯¾å¿œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #6f42c1 0%, #8e44ad 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary { background: #6f42c1; color: white; }
        .btn-primary:hover { background: #5a32a3; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-info:hover { background: #138496; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px 30px;
        }

        .panel {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .panel-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #495057;
        }

        .panel-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6f42c1;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .log-entry {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .log-operation {
            font-weight: bold;
            color: #6f42c1;
        }

        .log-timestamp {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .log-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-bottom: 8px;
        }

        .log-detail {
            display: flex;
            flex-direction: column;
        }

        .log-detail-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .log-detail-value {
            color: #212529;
            font-size: 0.8rem;
            word-break: break-word;
        }

        .spreadsheet-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .spreadsheet-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
        }

        .spreadsheet-id {
            font-weight: bold;
            color: #6f42c1;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .spreadsheet-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 0.8rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 30px;
        }

        .no-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ç›£æŸ»ãƒ­ã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <p>å…¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå¯¾å¿œ - è©³ç´°ç›£æŸ»ãƒ­ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="spreadsheetSelect">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé¸æŠ</label>
                <select id="spreadsheetSelect">
                    <option value="">ã™ã¹ã¦ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</option>
                </select>
            </div>

            <div class="control-group">
                <label for="operationFilter">æ“ä½œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</label>
                <select id="operationFilter">
                    <option value="">ã™ã¹ã¦ã®æ“ä½œ</option>
                </select>
            </div>

            <div class="control-group">
                <label for="dateFrom">é–‹å§‹æ—¥</label>
                <input type="date" id="dateFrom">
            </div>

            <div class="control-group">
                <label for="dateTo">çµ‚äº†æ—¥</label>
                <input type="date" id="dateTo">
            </div>

            <div class="control-group">
                <button class="btn btn-primary" onclick="refreshData()">ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
            </div>

            <div class="control-group">
                <button class="btn btn-success" onclick="exportData()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>

            <div class="control-group">
                <button class="btn btn-info" onclick="manualSync()">æ‰‹å‹•åŒæœŸ</button>
            </div>

            <div class="control-group">
                <button class="btn btn-warning" onclick="showConfig()">è¨­å®š</button>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="panel">
                <div class="panel-header">ğŸ“ˆ çµ±è¨ˆæƒ…å ±</div>
                <div class="panel-content" id="statsContainer">
                    <div class="loading">çµ±è¨ˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">ğŸ“‹ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§</div>
                <div class="panel-content" id="spreadsheetContainer">
                    <div class="loading">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">ğŸ“ æœ€æ–°ãƒ­ã‚° (50ä»¶)</div>
            <div class="panel-content" id="logsContainer">
                <div class="loading">ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { auditManager } from './audit-manager.js';
        import { auditConfig } from './audit-config.js';

        let currentSpreadsheetId = '';
        let currentLogs = [];
        let spreadsheetList = [];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeDashboard();
        });

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
        async function initializeDashboard() {
            try {
                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’å–å¾—
                await loadSpreadsheetList();
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                await refreshData();
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¨­å®š
                setupFilters();
                
            } catch (error) {
                console.error('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showError('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
        async function loadSpreadsheetList() {
            try {
                // SpreadsheetIds.gsã‹ã‚‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’å–å¾—
                if (window.SEAT_SHEET_IDS) {
                    spreadsheetList = Object.entries(window.SEAT_SHEET_IDS)
                        .filter(([key, id]) => id && id !== 'YOUR_SHEET_ID_HERE')
                        .map(([key, id]) => ({ key, id }));
                } else {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®š
                    spreadsheetList = [
                        { key: 'è¦‹æœ¬æ¼”åŠ‡-1-A', id: '1-lBQMuwjs0YnOpSt3nI8jQmHyNOqUNHiP3i2xXMcbmA' },
                        { key: 'è¦‹æœ¬æ¼”åŠ‡-1-B', id: '164pnCFDZKmrHlwU0J857NzxRHBeFgdKLzxCwM7DKZmo' }
                    ];
                }

                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé¸æŠãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
                const select = document.getElementById('spreadsheetSelect');
                select.innerHTML = '<option value="">ã™ã¹ã¦ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</option>';
                
                spreadsheetList.forEach(({ key, id }) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = `${key} (${id.substring(0, 20)}...)`;
                    select.appendChild(option);
                });

            } catch (error) {
                console.error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
        async function refreshData() {
            try {
                const spreadsheetId = document.getElementById('spreadsheetSelect').value;
                currentSpreadsheetId = spreadsheetId;

                // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
                await updateStats(spreadsheetId);
                
                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’æ›´æ–°
                await updateSpreadsheetList();
                
                // ãƒ­ã‚°ã‚’æ›´æ–°
                await updateLogs(spreadsheetId);

            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                showError('ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
        async function updateStats(spreadsheetId) {
            try {
                const container = document.getElementById('statsContainer');
                
                if (spreadsheetId) {
                    // ç‰¹å®šã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®çµ±è¨ˆ
                    const result = await auditManager.getStatsFromSpreadsheet(spreadsheetId);
                    if (result.success) {
                        displayStats(result.stats, container);
                    } else {
                        container.innerHTML = '<div class="error">çµ±è¨ˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message + '</div>';
                    }
                } else {
                    // å…¨ä½“ã®çµ±è¨ˆ
                    const stats = auditManager.getStats();
                    displayStats(stats, container);
                }

            } catch (error) {
                console.error('çµ±è¨ˆæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('statsContainer').innerHTML = '<div class="error">çµ±è¨ˆæƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        // çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
        function displayStats(stats, container) {
            const statsHtml = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">ç·ãƒ­ã‚°æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.demoOperations}</div>
                        <div class="stat-label">DEMOæ“ä½œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.normalOperations}</div>
                        <div class="stat-label">é€šå¸¸æ“ä½œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.errorCount || 0}</div>
                        <div class="stat-label">ã‚¨ãƒ©ãƒ¼æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${Object.keys(stats.byOperation || {}).length}</div>
                        <div class="stat-label">æ“ä½œç¨®é¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${Object.keys(stats.bySpreadsheet || {}).length}</div>
                        <div class="stat-label">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ•°</div>
                    </div>
                </div>
            `;
            container.innerHTML = statsHtml;
        }

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’æ›´æ–°
        async function updateSpreadsheetList() {
            try {
                const container = document.getElementById('spreadsheetContainer');
                const spreadsheetHtml = spreadsheetList.map(({ key, id }) => `
                    <div class="spreadsheet-card">
                        <div class="spreadsheet-id">${key}</div>
                        <div class="spreadsheet-stats">
                            <div>ID: ${id.substring(0, 20)}...</div>
                            <div>çŠ¶æ…‹: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</div>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `<div class="spreadsheet-list">${spreadsheetHtml}</div>`;

            } catch (error) {
                console.error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('spreadsheetContainer').innerHTML = '<div class="error">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        // ãƒ­ã‚°ã‚’æ›´æ–°
        async function updateLogs(spreadsheetId) {
            try {
                const container = document.getElementById('logsContainer');
                
                if (spreadsheetId) {
                    // ç‰¹å®šã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ­ã‚°
                    const result = await auditManager.getLogsFromSpreadsheet(spreadsheetId, 50, 0);
                    if (result.success) {
                        displayLogs(result.logs, container);
                    } else {
                        container.innerHTML = '<div class="error">ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message + '</div>';
                    }
                } else {
                    // å…¨ä½“ã®ãƒ­ã‚°
                    const logs = auditManager.getLogs().slice(0, 50);
                    displayLogs(logs, container);
                }

            } catch (error) {
                console.error('ãƒ­ã‚°æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('logsContainer').innerHTML = '<div class="error">ãƒ­ã‚°ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        // ãƒ­ã‚°ã‚’è¡¨ç¤º
        function displayLogs(logs, container) {
            if (logs.length === 0) {
                container.innerHTML = '<div class="no-data">ãƒ­ã‚°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            const logsHtml = logs.map(log => `
                <div class="log-entry">
                    <div class="log-header">
                        <div class="log-operation">${getOperationText(log.operation)}</div>
                        <div class="log-timestamp">${formatTimestamp(log.timestamp)}</div>
                    </div>
                    <div class="log-details">
                        <div class="log-detail">
                            <div class="log-detail-label">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID</div>
                            <div class="log-detail-value">${log.spreadsheetId || '-'}</div>
                        </div>
                        <div class="log-detail">
                            <div class="log-detail-label">ã‚°ãƒ«ãƒ¼ãƒ—</div>
                            <div class="log-detail-value">${log.group || '-'}</div>
                        </div>
                        <div class="log-detail">
                            <div class="log-detail-label">ãƒ¢ãƒ¼ãƒ‰</div>
                            <div class="log-detail-value">${log.mode?.mode || '-'}</div>
                        </div>
                        <div class="log-detail">
                            <div class="log-detail-label">URL</div>
                            <div class="log-detail-value">${log.url || '-'}</div>
                        </div>
                    </div>
                    ${log.error ? `<div class="log-detail"><div class="log-detail-label">ã‚¨ãƒ©ãƒ¼</div><div class="log-detail-value" style="color: #dc3545;">${log.error}</div></div>` : ''}
                </div>
            `).join('');

            container.innerHTML = logsHtml;
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¨­å®š
        function setupFilters() {
            const operationFilter = document.getElementById('operationFilter');
            const operations = [
                'reservation_start', 'reservation_success', 'reservation_failed',
                'checkin_start', 'checkin_success', 'mode_change_success',
                'walkin_issue_start', 'walkin_issue_success'
            ];

            operations.forEach(operation => {
                const option = document.createElement('option');
                option.value = operation;
                option.textContent = getOperationText(operation);
                operationFilter.appendChild(option);
            });
        }

        // æ“ä½œãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
        function getOperationText(operation) {
            const texts = {
                'reservation_start': 'äºˆç´„é–‹å§‹',
                'reservation_success': 'äºˆç´„æˆåŠŸ',
                'reservation_failed': 'äºˆç´„å¤±æ•—',
                'checkin_start': 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³é–‹å§‹',
                'checkin_success': 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æˆåŠŸ',
                'mode_change_success': 'ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´æˆåŠŸ',
                'walkin_issue_start': 'å½“æ—¥åˆ¸ç™ºè¡Œé–‹å§‹',
                'walkin_issue_success': 'å½“æ—¥åˆ¸ç™ºè¡ŒæˆåŠŸ'
            };
            return texts[operation] || operation;
        }

        // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // æ‰‹å‹•åŒæœŸ
        async function manualSync() {
            try {
                const result = await auditManager.manualSync();
                if (result.success) {
                    alert('åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸ: ' + result.message);
                    await refreshData();
                } else {
                    alert('åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
                }
            } catch (error) {
                alert('åŒæœŸã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        async function exportData() {
            try {
                const spreadsheetId = document.getElementById('spreadsheetSelect').value;
                
                if (spreadsheetId) {
                    const result = await auditManager.getLogsFromSpreadsheet(spreadsheetId, 10000, 0);
                    if (result.success) {
                        exportToFile(result.logs, `audit_logs_${spreadsheetId.substring(0, 10)}.json`);
                    } else {
                        alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
                    }
                } else {
                    const logs = auditManager.getLogs();
                    exportToFile(logs, 'audit_logs_all.json');
                }
            } catch (error) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportToFile(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // è¨­å®šã‚’è¡¨ç¤º
        function showConfig() {
            const config = auditManager.getConfig();
            const configText = `
=== ç›£æŸ»ãƒ­ã‚°è¨­å®š ===

æœ‰åŠ¹: ${config.isEnabled}
è‡ªå‹•åŒæœŸ: ${config.autoSync}
åŒæœŸé–“éš”: ${config.syncInterval / 1000}ç§’
æœ€å¤§ãƒ­ã‚°æ•°: ${config.maxLogs}
åŒæœŸå¾…ã¡ãƒ­ã‚°: ${config.pendingLogs}ä»¶
æœ€çµ‚åŒæœŸ: ${config.lastSyncTime ? new Date(config.lastSyncTime).toLocaleString('ja-JP') : 'æœªå®Ÿè¡Œ'}
            `;
            alert(configText);
        }

        // ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
        function showError(message) {
            const container = document.getElementById('logsContainer');
            container.innerHTML = `<div class="error">${message}</div>`;
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.refreshData = refreshData;
        window.exportData = exportData;
        window.manualSync = manualSync;
        window.showConfig = showConfig;
    </script>
</body>
</html>
