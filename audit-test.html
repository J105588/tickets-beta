<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Áõ£Êüª„É≠„Ç∞„ÉÜ„Çπ„Éà">
    <title>Áõ£Êüª„É≠„Ç∞„Ç∑„Çπ„ÉÜ„É† „ÉÜ„Çπ„Éà„Éö„Éº„Ç∏</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #34495e;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .log-display {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #bee5eb;
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }

            .section h2 {
                font-size: 1.2em;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
                font-size: 16px; /* iOS „ÅÆ„Ç∫„Éº„É†Èò≤Ê≠¢ */
                min-height: 44px; /* „Çø„ÉÉ„ÉÅ„Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆÊúÄÂ∞è„Çµ„Ç§„Ç∫ */
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* iOS „ÅÆ„Ç∫„Éº„É†Èò≤Ê≠¢ */
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 10px;
            }

            .stat-value {
                font-size: 1.5em;
            }

            .log-display {
                font-size: 11px;
                max-height: 200px;
            }
        }

        /* iPad ÂØæÂøú */
        @media (min-width: 768px) and (max-width: 1024px) {
            .button-group {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÁî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover {
                transform: none;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Áõ£Êüª„É≠„Ç∞„Ç∑„Çπ„ÉÜ„É† „ÉÜ„Çπ„Éà„Éö„Éº„Ç∏</h1>
        
        <!-- Êé•Á∂öÁä∂ÊÖã -->
        <div class="section">
            <h2>Êé•Á∂öÁä∂ÊÖã</h2>
            <div id="connectionStatus" class="status disconnected">
                „Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö‰∏≠...
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="checkConnection()">Êé•Á∂öÁ¢∫Ë™ç</button>
                <button class="btn btn-warning" onclick="reconnect()">ÂÜçÊé•Á∂ö</button>
            </div>
        </div>
        
        <!-- Áµ±Ë®àÊÉÖÂ†± -->
        <div class="section">
            <h2>Áµ±Ë®àÊÉÖÂ†±</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalLogs">0</div>
                    <div class="stat-label">Á∑è„É≠„Ç∞Êï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="syncedLogs">0</div>
                    <div class="stat-label">ÂêåÊúüÊ∏à„Åø</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingLogs">0</div>
                    <div class="stat-label">Êú™ÂêåÊúü</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="errorLogs">0</div>
                    <div class="stat-label">„Ç®„É©„ÉºÊï∞</div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-info" onclick="updateStats()">Áµ±Ë®àÊõ¥Êñ∞</button>
                <button class="btn btn-success" onclick="forceSync()">ÊâãÂãïÂêåÊúü</button>
            </div>
        </div>
        
        <!-- „É≠„Ç∞Ë®òÈå≤„ÉÜ„Çπ„Éà -->
        <div class="section">
            <h2>„É≠„Ç∞Ë®òÈå≤„ÉÜ„Çπ„Éà</h2>
            <div class="form-group">
                <label for="operationType">Êìç‰Ωú„Çø„Ç§„Éó:</label>
                <select id="operationType">
                    <option value="seat_reservation">Â∫ßÂ∏≠‰∫àÁ¥Ñ</option>
                    <option value="checkin">„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥</option>
                    <option value="walkin_ticket">ÂΩìÊó•Âà∏Áô∫Ë°å</option>
                    <option value="seat_edit">Â∫ßÂ∏≠Á∑®ÈõÜ</option>
                    <option value="mode_change">„É¢„Éº„ÉâÂ§âÊõ¥</option>
                    <option value="user_action">„É¶„Éº„Ç∂„Éº„Ç¢„ÇØ„Ç∑„Éß„É≥</option>
                    <option value="system_event">„Ç∑„Çπ„ÉÜ„É†„Ç§„Éô„É≥„Éà</option>
                    <option value="data_change">„Éá„Éº„ÇøÂ§âÊõ¥</option>
                    <option value="javascript_error">JavaScript„Ç®„É©„Éº</option>
                </select>
            </div>
            <div class="form-group">
                <label for="logDetails">Ë©≥Á¥∞ÊÉÖÂ†± (JSON):</label>
                <textarea id="logDetails" placeholder='{"message": "„ÉÜ„Çπ„Éà„É≠„Ç∞", "data": {"id": 123}}'></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="testLog()">„É≠„Ç∞Ë®òÈå≤</button>
                <button class="btn btn-warning" onclick="testErrorLog()">„Ç®„É©„Éº„É≠„Ç∞Ë®òÈå≤</button>
                <button class="btn btn-danger" onclick="testMultipleLogs()">Ë§áÊï∞„É≠„Ç∞Ë®òÈå≤</button>
            </div>
        </div>
        
        <!-- „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ -->
        <div class="section">
            <h2>„Ç∑„Çπ„ÉÜ„É†„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</h2>
            <div class="button-group">
                <button class="btn btn-success" onclick="simulateSeatReservation()">Â∫ßÂ∏≠‰∫àÁ¥Ñ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</button>
                <button class="btn btn-info" onclick="simulateCheckin()">„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</button>
                <button class="btn btn-warning" onclick="simulateWalkinTicket()">ÂΩìÊó•Âà∏Áô∫Ë°å„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</button>
                <button class="btn btn-primary" onclick="simulateModeChange()">„É¢„Éº„ÉâÂ§âÊõ¥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</button>
            </div>
        </div>
        
        <!-- „É≠„Ç∞Ë°®Á§∫ -->
        <div class="section">
            <h2>„É≠„Ç∞Ë°®Á§∫</h2>
            <div class="button-group">
                <button class="btn btn-info" onclick="showRecentLogs()">ÊúÄËøë„ÅÆ„É≠„Ç∞Ë°®Á§∫</button>
                <button class="btn btn-warning" onclick="clearLogDisplay()">„É≠„Ç∞„ÇØ„É™„Ç¢</button>
            </div>
            <div id="logDisplay" class="log-display">„É≠„Ç∞„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô...</div>
        </div>
        
        <!-- Ë®≠ÂÆö -->
        <div class="section">
            <h2>Ë®≠ÂÆö</h2>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="enableAudit" checked> Áõ£Êüª„É≠„Ç∞„ÇíÊúâÂäπ„Å´„Åô„Çã
                </label>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="enableAutoSync" checked> Ëá™ÂãïÂêåÊúü„ÇíÊúâÂäπ„Å´„Åô„Çã
                </label>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="updateSettings()">Ë®≠ÂÆöÊõ¥Êñ∞</button>
                <button class="btn btn-info" onclick="resetSettings()">Ë®≠ÂÆö„É™„Çª„ÉÉ„Éà</button>
            </div>
        </div>
    </div>

    <!-- Áõ£Êüª„É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†„ÅÆË™≠„ÅøËæº„Åø -->
    <script src="audit-client.js"></script>
    <script src="audit-integration.js"></script>
    
    <script>
        // „ÉÜ„Çπ„ÉàÁî®„ÅÆ„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        window.currentSpreadsheetId = 'test-spreadsheet-123';
        window.currentGroup = '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó';
        window.currentDay = '1';
        window.currentTimeslot = 'A';
        window.currentMode = 'normal';
        window.isDemoMode = false;
        window.demoGroup = null;
        
        // „ÉÜ„Çπ„ÉàÁî®„ÅÆ„Éá„Éº„Çø
        window.seatsData = {
            'seat-1': { id: 'seat-1', number: 'A1', status: 'available', group: '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó' },
            'seat-2': { id: 'seat-2', number: 'A2', status: 'reserved', group: '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó' }
        };
        
        window.walkinData = {
            'ticket-1': { id: 'ticket-1', number: 'W001', status: 'issued', group: '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó' }
        };

        // „ÉÜ„Çπ„ÉàÈñ¢Êï∞
        function checkConnection() {
            const status = document.getElementById('connectionStatus');
            if (window.auditClient && window.auditClient.isServerConnected()) {
                status.textContent = '„Çµ„Éº„Éê„Éº„Å´Êé•Á∂öÊ∏à„Åø';
                status.className = 'status connected';
            } else {
                status.textContent = '„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì';
                status.className = 'status disconnected';
            }
        }

        function reconnect() {
            if (window.auditClient) {
                window.auditClient.connectToServer().then(() => {
                    checkConnection();
                    showMessage('ÂÜçÊé•Á∂ö„Åó„Åæ„Åó„Åü', 'success');
                }).catch(error => {
                    showMessage('ÂÜçÊé•Á∂ö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
                });
            }
        }

        function updateStats() {
            if (window.auditClient) {
                window.auditClient.getStats().then(stats => {
                    document.getElementById('totalLogs').textContent = stats.total;
                    document.getElementById('syncedLogs').textContent = stats.synced;
                    document.getElementById('pendingLogs').textContent = stats.pending;
                    document.getElementById('errorLogs').textContent = stats.errors;
                });
            }
        }

        function forceSync() {
            if (window.auditClient) {
                window.auditClient.forceSync().then(() => {
                    showMessage('ÊâãÂãïÂêåÊúü„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                    updateStats();
                }).catch(error => {
                    showMessage('ÂêåÊúü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
                });
            }
        }

        function testLog() {
            const operation = document.getElementById('operationType').value;
            const detailsText = document.getElementById('logDetails').value;
            
            let details = {};
            try {
                if (detailsText.trim()) {
                    details = JSON.parse(detailsText);
                }
            } catch (error) {
                showMessage('JSONÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            if (window.auditClient) {
                window.auditClient.log(operation, details);
                showMessage(`„É≠„Ç∞„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü: ${operation}`, 'success');
                updateStats();
            }
        }

        function testErrorLog() {
            const operation = document.getElementById('operationType').value;
            const details = {
                error: '„ÉÜ„Çπ„Éà„Ç®„É©„Éº',
                stackTrace: 'Error: „ÉÜ„Çπ„Éà„Ç®„É©„Éº\n    at testErrorLog (test.html:123:45)',
                message: '„Åì„Çå„ÅØ„ÉÜ„Çπ„ÉàÁî®„ÅÆ„Ç®„É©„Éº„É≠„Ç∞„Åß„Åô'
            };
            
            if (window.auditClient) {
                window.auditClient.log(operation, details);
                showMessage(`„Ç®„É©„Éº„É≠„Ç∞„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü: ${operation}`, 'success');
                updateStats();
            }
        }

        function testMultipleLogs() {
            const operations = [
                'seat_reservation',
                'checkin',
                'walkin_ticket',
                'seat_edit',
                'mode_change'
            ];
            
            operations.forEach((operation, index) => {
                setTimeout(() => {
                    if (window.auditClient) {
                        window.auditClient.log(operation, {
                            message: `„ÉÜ„Çπ„Éà„É≠„Ç∞ ${index + 1}`,
                            timestamp: new Date().toISOString(),
                            data: { id: index + 1 }
                        });
                    }
                }, index * 100);
            });
            
            showMessage('Ë§áÊï∞„É≠„Ç∞„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü', 'success');
            setTimeout(updateStats, 1000);
        }

        function simulateSeatReservation() {
            if (window.auditClient) {
                window.auditClient.log('seat_reservation', {
                    seatId: 'A1',
                    seatNumber: 'A1',
                    group: '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó',
                    day: '1',
                    timeslot: 'A',
                    beforeData: { status: 'available' },
                    afterData: { status: 'reserved', reservedBy: '„ÉÜ„Çπ„Éà„É¶„Éº„Ç∂„Éº' }
                });
                showMessage('Â∫ßÂ∏≠‰∫àÁ¥Ñ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                updateStats();
            }
        }

        function simulateCheckin() {
            if (window.auditClient) {
                window.auditClient.log('checkin', {
                    seatId: 'A1',
                    seatNumber: 'A1',
                    group: '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó',
                    day: '1',
                    timeslot: 'A',
                    beforeData: { status: 'reserved' },
                    afterData: { status: 'checked_in', checkedInAt: new Date().toISOString() }
                });
                showMessage('„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                updateStats();
            }
        }

        function simulateWalkinTicket() {
            if (window.auditClient) {
                window.auditClient.log('walkin_ticket', {
                    ticketId: 'W001',
                    ticketNumber: 'W001',
                    group: '„ÉÜ„Çπ„Éà„Ç∞„É´„Éº„Éó',
                    day: '1',
                    timeslot: 'A',
                    beforeData: null,
                    afterData: { status: 'issued', issuedAt: new Date().toISOString() }
                });
                showMessage('ÂΩìÊó•Âà∏Áô∫Ë°å„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                updateStats();
            }
        }

        function simulateModeChange() {
            if (window.auditClient) {
                window.auditClient.log('mode_change', {
                    fromMode: 'normal',
                    toMode: 'demo',
                    beforeData: { mode: 'normal', isDemo: false },
                    afterData: { mode: 'demo', isDemo: true }
                });
                showMessage('„É¢„Éº„ÉâÂ§âÊõ¥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                updateStats();
            }
        }

        function showRecentLogs() {
            // ÊúÄËøë„ÅÆ„É≠„Ç∞„ÇíË°®Á§∫ÔºàÂÆüË£Ö„Å´Âøú„Åò„Å¶Ë™øÊï¥Ôºâ
            const logDisplay = document.getElementById('logDisplay');
            logDisplay.textContent = 'ÊúÄËøë„ÅÆ„É≠„Ç∞„ÇíÂèñÂæó‰∏≠...';
            
            // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ„ÄÅ„Çµ„Éº„Éê„Éº„Åã„Çâ„É≠„Ç∞„ÇíÂèñÂæó
            setTimeout(() => {
                logDisplay.textContent = '„É≠„Ç∞Ë°®Á§∫Ê©üËÉΩ„ÅØÂÆüË£Ö‰∏≠„Åß„Åô...';
            }, 1000);
        }

        function clearLogDisplay() {
            document.getElementById('logDisplay').textContent = '„É≠„Ç∞„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô...';
        }

        function updateSettings() {
            const enableAudit = document.getElementById('enableAudit').checked;
            const enableAutoSync = document.getElementById('enableAutoSync').checked;
            
            if (window.auditClient) {
                window.auditClient.isEnabled = enableAudit;
                window.auditClient.autoSync = enableAutoSync;
                
                if (enableAutoSync) {
                    window.auditClient.startAutoSync();
                } else {
                    window.auditClient.stopAutoSync();
                }
            }
            
            showMessage('Ë®≠ÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
        }

        function resetSettings() {
            document.getElementById('enableAudit').checked = true;
            document.getElementById('enableAutoSync').checked = true;
            updateSettings();
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            // Êé•Á∂öÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
            setTimeout(checkConnection, 2000);
            
            // Áµ±Ë®àÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            setTimeout(updateStats, 3000);
            
            // ÂÆöÊúüÁöÑ„Å´Êé•Á∂öÁä∂ÊÖã„Å®Áµ±Ë®à„ÇíÊõ¥Êñ∞
            setInterval(() => {
                checkConnection();
                updateStats();
            }, 10000);
        });
    </script>
</body>
</html>
