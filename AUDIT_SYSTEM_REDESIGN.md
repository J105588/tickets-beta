# 監査ログシステム再設計計画

## 📋 現在のシステム分析

### 必要なファイル（保持・改良）
- `audit-logger.js` - コア監査ログ機能（再設計）
- `Code.gs` - GAS側API（大幅改良）
- `SpreadsheetIds.gs` - スプレッドシートID管理（拡張）
- `audit-viewer.html` - ログビューア（改良）
- `sidebar.js` - UI統合（軽微修正）

### 不要なファイル（削除対象）
- `audit-sync-manager.js` - 複雑すぎる、シンプル化
- `audit-test.html` - テスト用、本番不要
- `AUDIT_LOG_SYNC_GUIDE.md` - 古いガイド
- `INTEGRATION_SUMMARY.md` - 統合完了後不要

### 新規作成ファイル
- `audit-manager.js` - シンプルな監査ログ管理
- `audit-config.js` - 監査ログ設定管理
- `audit-dashboard.html` - 統合ダッシュボード

## 🎯 再設計の目標

### 1. 全スプレッドシート対応
- すべてのスプレッドシートIDに対して監査ログを記録
- スプレッドシートID指定での操作
- 各スプレッドシートの操作履歴を個別管理

### 2. 詳細記録
- 操作前後のデータ状態
- ユーザー情報（デバイス、ブラウザ等）
- 操作の詳細（座席、予約、チェックイン等）
- エラー情報とスタックトレース

### 3. シンプル化
- 複雑な同期機能を削除
- 直接的なスプレッドシート連携
- 明確な責任分離

## 📊 新しいアーキテクチャ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   GAS API       │    │ Spreadsheets    │
│                 │    │                 │    │                 │
│ audit-manager.js│───▶│ Code.gs         │───▶│ 各スプレッドシート │
│ audit-config.js │    │ (監査ログAPI)    │    │ (監査ログシート)  │
│ dashboard.html  │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🔧 実装計画

### Phase 1: ファイル整理
1. 不要ファイルの削除
2. 必要なファイルの特定
3. 新規ファイルの作成

### Phase 2: コア機能再設計
1. 監査ログ管理システムの再構築
2. GAS APIの改良
3. スプレッドシートID管理の拡張

### Phase 3: UI統合
1. ダッシュボードの作成
2. 既存UIとの統合
3. テストと検証
